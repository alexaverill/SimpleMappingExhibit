<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./leaflet/leaflet.css" />
    <script src="./leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="main.css" />
  </head>
  <div id="map"></div>

    <div id="dialog" class="dialog editDialog hidden">
      <div class="dialogbuttons">
        <button onClick="closeDialog()" class="dialogActionButton"><img class="icon" src="./assets/save.png" /></button>
        <button onClick="deletePoint()" class="dialogActionButton"><img class="icon" src="./assets/delete.png" /></button>
    
    </div>
    <input type="hidden" value="null" id="id"/>
    <div class="dialogInputTitle" id="dialogTitle">
      <input id="title" type="text" class="title" placeholder="Title" />
    </div>
    <div class="image" id="dialogImageContainer">
      <button id="previous" onClick="handlePreviousImage()" class="imageIcon hide">
        <img class="icon" src="./assets/arrow.png" />
      </button>
      <img id="dialogImage" src="" alt="" />
      <button id="next" onClick="handleNextImage()" class="imageIcon hide">
        <img class="icon" src="./assets/arrow.png" />
      </button>
      <button id="add" onClick="handleAddImage()" class="addButton">
        <img class="icon" src="./assets/add.png"/>
      </button>
    </div>
    <div class="descriptionTextArea" id="dialogDescription"><textarea id="description" placeholder="Description"></textarea></textarea></div>
  </div>
  <div id="userInstructions" class="userInstructions hide">
      <div id="progress">
    <div class="progressBar">
      <div class="bar"></div>
      <div class="progressIndicator active" id="baseLayerProgress">Base Layers</div>
    <div class="progressIndicator" id="mapCenterProgress">Map Center</div>
    <div class="progressIndicator" id="pointsProgress">Points</div>
    <div class="progressIndicator" id="boundsProgress">Bounds</div>
    <div class="progressIndicator" id="zoomProgress">Zoom Levels</div>
    
    </div>
  </div>
    <div id="instructions" class="title">Select the Center of your map</div>
    <div id="subtitle" class="subtitle"></div>
    <div class="userInstructionButtons" id="userInstructionButtons">
    <button onclick="finishStep()">Continue</button>
    </div>
  </div>
  <button class="editButton" onclick="showIntro()">Start</button>
  <dialog id="intro">
    <div class="dialogContent">
      <div class="title">Map Builder</div>
<div class="titleLine"></div>
      <div class="description">
        <div>This is a tool to help you build out a mapping interactive.</div>
        <div>Before you get started make sure that you have:
          <ol>
            <li>Placed all your images are already hosted online somewhere, or in the images folder in the directory.</li>
          </ol>
        </div>
      </div>
      <div class="uploadPrompt">
        Upload a JSON file to edit: <input type="file" />
      </div>
      <div class="titleLine bottomLine"></div>
      <button onClick="finishStep()">Continue</button>
    </div>
  </dialog>
    <dialog id="imageAdd" class="imageAddDialog">
    <div class="dialogContent">
      <div class="title">Add Images</div>
      <div class="description">
        <div id="imageList" class="imageList"></div>
        <div class="imageAdd">Add a local image: <input id="imageInput" type="file" onchange="handlePrevewImageSelect()" accept="image/png, image/jpeg, image/jpg"/></div>
        <div class="imageAdd">Link to an Image: <input type="text" id="imageLink" value="https://upload.wikimedia.org/wikipedia/commons/5/53/Ice_Skating-William_Frerichs-1869.jpg"><button onclick="addLinkedImage()">Add</button></button></div>
      </div>
      <div class="buttonBar">
      <button onClick="cancelImageSelect()">Cancel</button> <button onClick="handleImagesSelected()">Save</button>
      </div>
    </div>
  </dialog>
  <dialog id="baseLayerSelection">
    <div class="dialogContent">
      <div class="title">Base Maps</div>
            <div class="titleLine"></div>
      <div class="description">
        <div>Base layers control the appearance of the base map.</div> 
        <div><a href="https://leaflet-extras.github.io/leaflet-providers/preview/" target="_blank">A full list of possible base maps. </a></div>
        <div>Generally you don't need more then one or two base maps.</div>
      </div>
        <div class="subtitle">Current Base Layers:</div>
        <div class="baseLayerList" id="baseLayers">

        </div>
        <div class="addBaseLayer">
          <button onclick="addBaseLayerUI()">Add Layer</button>
        </div>
        <div class="titleLine bottomLine"></div>
        <div class="buttonBar">
          <button onclick="finishStep()">Continue</button>
        </div>
      
      
    </div>
  </dialog>
    <dialog id="zoomSelection">
    <div class="dialogContent">
      <div class="title">Define zoom levels</div>
      <div class="description">
        <div>The minimum zoom level is how far out a user can zoom the map this should be as close to the edges of your bounding box</div>
        <div>The maximum zoom level is how close people can zoom into the map. The default is the maximum zoom possible for the map  and baselayers</div> 
      </div>
      <div class="buttonBar">
        <button onclick="advanceToSelectZoom()">Continue</button>
      </div>
    </div>
  </dialog>

    <dialog id="boundsSelectionDialog">
      <div class="dialogContent">
      <div class="title">Select Map Bounds</div>
      <div class="description">
        <div>Select the outer limits that you want people to be able to drag the map to. </div>
        <div>Your bounding box should include some padding around your points to ensure that people can see all your points. When in doubt go larger. </div>
      </div>
        <div class="buttonBar">
        <button onClick="skipBounds()">Skip</button>
        <button onClick="advanceToBounds()">Select Bounds</button>
      </div>
    </div>
  </dialog>
    <dialog id="completedMap">
        <div class="dialogContent">
      <div class="title">Map Complete!</div>
      <div class="description">
        You have completed your map, you can now download the data file and place it nex to the index.html file. Ensure all the images you selected are in a images folder that is next to the index.html file. 
      <div div class="buttonBar">
        <button onClick="closeComplete()">Close </button>
        <a href="" type="download" id="downloadLink" class="download">Download</button>
      </div>
    </div>
  </dialog>
  <div
    id="dialogBackground"
    class="dialogBackground"
    onclick="handleBackgroundClick()"
  ></div>

  <script>
    const steps = {
      Intro:0,
      BaseLayer:1,
      Center: 2,
      Points: 3,
      Editing: 4,
      Bounds: 5,
            MinZoomLevel: 6,
            MaxZoomLevel:7
    };
    let baseLayers = [
    {
    name:'Satellite',
    tileUrl:"https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}",
    options:{
      minZoomLevel:1,
      maxZoomLevel:20,
      attribution:'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>'

    }
  },
    {
    name:'Street Map',
    tileUrl:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",
    options:{
      minZoomLevel:1,
      maxZoomLevel:15,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',

    }
  }
  
    ];
    let currentStep = steps.Intro;
    let currentMapCenter = null;
    let centerMarker = null;
    let map;
    let mapLayerControl;
    let currentImage = 0;
    let content = null;
    let dialogTitle = document.getElementById("dialogTitle");
    let dialogImage = document.getElementById("dialogImage");
    let dialogDescription = document.getElementById("dialogDescription");
    let isClicked = false;
    let startPos = null;
    let endPos = null;
    let rectangle = null;
    let pointsOfInterest = null;
    let points = [];
    let pointLatLng = null;
    let newPointRef = null;
     let imageList = [];
     let bounds;
     let originalZoomlevel = null;
     let boundsRect = null;
     let maxZoomLevel = null;
     let minZoomLevel = null;
     //Intro Functionality
    const showIntro = () => {
      document.getElementById("intro").showModal();
    };
    //Bounds Funtions
    const handleResetBounds = ()=>{
      map.removeLayer(boundsRect);
      isClicked =false;
      map.setZoom(originalZoomlevel);
    }
    const advanceToBounds = () =>{
      isClicked = false;
      document.getElementById("boundsSelectionDialog").close();
      let resetBtn = document.createElement('button');
      resetBtn.onclick=handleResetBounds;
      resetBtn.appendChild(document.createTextNode("Reset"));
      document.getElementById("userInstructionButtons").prepend(resetBtn);
      setInstructions("Click to start drawing a boundary box.", "");
      currentStep = steps.Bounds;
    }
    
    //Map Center Point
    const advanceToMapCenter = () => {
      currentStep = steps.Center
      advanceProgress("baseLayerProgress","mapCenterProgress")
      document.getElementById("intro").close();
      document.getElementById("userInstructions").classList.remove("hide");
      setInstructions(
        "Select the center of your map.",""
      );
    };
    const addCenterMarker = () => {
      if (centerMarker && map) {
        map.removeLayer(centerMarker);
      }
      var myIcon = L.icon({
        iconUrl: "assets/flag.svg",
        iconSize: [40, 40],
        iconAnchor: [11, 30],
        popupAnchor: [-3, -76],
        shadowSize: [68, 95],
        shadowAnchor: [22, 94],
      });

      centerMarker = L.marker(currentMapCenter, { icon: myIcon }).addTo(map);
    };
    
    //Zoom Levelts
    const advanceToSelectZoom = ()=>{
      currentStep = steps.MinZoomLevel;
      document.getElementById("userInstructionButtons").innerHTML='';
            document.getElementById("zoomSelection").close();
      let resetBtn = document.createElement('button');
      resetBtn.onclick=finishStep;
      resetBtn.appendChild(document.createTextNode("Set and Continue"));
      document.getElementById("userInstructionButtons").prepend(resetBtn);
      setInstructions("Suggested minimum zoom level.","Zoom in or out to modify.", "");
    }
    const advanceToSelectMaxZoom = ()=>{
      console.log("Max Zoom!");
      currentStep = steps.MaxZoomLevel;
            document.getElementById("userInstructionButtons").innerHTML='';
      let resetBtn = document.createElement('button');
      resetBtn.onclick=finishStep;
      resetBtn.appendChild(document.createTextNode("Set and Continue"));
      document.getElementById("userInstructionButtons").prepend(resetBtn);
      map.setZoom(map.getMaxZoom());
      setInstructions("Suggested Maximum zoom level?", "Zoom in or out to modify");
    }


    //Base Layer functions
        const advanceToBaseLayers = () =>{
      currentStep = steps.BaseLayer;
      document.getElementById("intro").close();
      document.getElementById("baseLayerSelection").showModal();
      for(let layer of baseLayers){
        buildBaseLayerInput(layer.name,layer.tileUrl,layer.options.attribution,layer.options.minZoomLevel,layer.options.maxZoomLevel)
      }
      
    }
    const setBaseLayers = ()=>{
      map.eachLayer((layer)=>{
        map.removeLayer(layer);
      });
      if(mapLayerControl){
        map.removeControl(mapLayerControl);
      }
      let tileNames = {}
      for(let layer of baseLayers){
        console.log(layer);
        let tileLayer = L.tileLayer(layer.tileUrl,layer.options);
        tileLayer.addTo(map);
        tileNames[layer.name] = tileLayer
      }
      mapLayerControl =L.control
        .layers(tileNames, {}, { position: "bottomright" })
        .addTo(map);
    }
    const addBaseLayerUI = ()=>{
      buildBaseLayerInput();
      setDeleteButtonDisabled(false);
    }
    const setDeleteButtonDisabled = (state)=>{
      let baseLayerList = document.getElementById("baseLayers").children;
      console.log(baseLayerList);
      for(let layer of baseLayerList){
        let deleteButton = layer.querySelector(".deleteRow");
        deleteButton.disabled = state;
      }
    }
    const removeBaseLayer = (parent,container,layerName)=>{
      
        parent.removeChild(container)
        let removeIndex = baseLayers.findIndex((layer)=>layer.name == layerName);
        baseLayers.splice(removeIndex,1);
        let currentLength = document.getElementById("baseLayers").children.length;
        if(currentLength <=1){
          setDeleteButtonDisabled(true);
        }
    }
    const buildBaseLayerInput = (layerName='',layerTile='',layerAttribution='',layerMinZoom=1,layerMaxZoom=20)=>{
      let parent = document.getElementById("baseLayers");
      let container  = document.createElement('div');
      container.className='baseLayerInputRow';
      let deleteBtn = document.createElement('button');
      deleteBtn.className='deleteRow dialogActionButton'
      deleteBtn.onclick = ()=>removeBaseLayer(parent,container,layerName);
      deleteBtn.innerHTML = '<img src="./assets/delete.png">';
      let name = createInputElements('name','Name:',layerName);
      let tilesUrl = createLongInputElemeent('tiles','Tiles Url:',layerTile);
      let attribution = createLongInputElemeent('attribution','Attribution:',layerAttribution);
      let minZoom = createZoomInput('minZoom','Min Zoom: ',layerMinZoom)
      let maxZoom = createZoomInput('maxZoom','Max Zoom: ',layerMaxZoom)
      container.appendChild(deleteBtn);
      container.appendChild(name);
      container.appendChild(tilesUrl);
      container.appendChild(attribution);
      container.appendChild(minZoom);
      container.appendChild(maxZoom);
      parent.appendChild(container);
    }
    const createLongInputElemeent = (id,label,value) =>{
      let div = document.createElement('div');
      div.className ='inputRow';
      let input = document.createElement('textarea');
      input.className = 'baseLayerInput';
      input.id=id;
      input.value=value;
     let inputLabel = createLabel(id,label);
     div.appendChild(inputLabel);
     div.appendChild(input);
     return div;
    }
    const createInputElements = (id,label,value)=>{
      let div = document.createElement('div');
      div.className ='inputRow';
      let input = document.createElement('input');
      input.className = 'baseLayerInput';
      input.type = 'text';
      input.id=id;
      input.value=value;
     let inputLabel = createLabel(id,label);
     div.appendChild(inputLabel);
     div.appendChild(input);
     return div;
    }
    const createZoomInput = (id,label,value)=>{
      let div = document.createElement('div');
      div.className = 'inputRow';
      let input = document.createElement('input');
      input.className = 'baseLayerInput';
      input.type = 'number';
      input.id=id;
      input.value=value;
      let inputLabel = createLabel(id,label);
     div.appendChild(inputLabel);
     div.appendChild(input);
     return div;
    }
    const createLabel = (id,label) =>{
    let inputLabel = document.createElement('label');
     inputLabel.className='inputLabel';
     inputLabel.htmlFor=id;
     inputLabel.innerText=label;
     return inputLabel;
    }
       
    //Content Dialog Setup
    const addLinkedImage = ()=>{
      let link = document.getElementById("imageLink");
      buildImagePreview(link.value);
      link.value='';
    }
    const handlePrevewImageSelect =(e)=>{
      let files = document.getElementById("imageInput").files;
      console.log(files);
      let path =  `./images/${files[0].name}`;
      buildImagePreview(path);
    }
        const deletePoint = ()=>{
      let currentid = document.getElementById("id").value;
      if(currentid ==='null'){
        map.removeLayer(newPointRef);
      }else{
        let index = points.findIndex(point =>point.id ==currentid);
        map.removeLayer(points[index].pointRef);
        points.splice(index,1);
      }
      document
        .getElementById("dialogBackground")
        .classList.remove("dialogBackgroundVisible");
      document.getElementById("dialog").classList.remove("visible");
      document.getElementById("title").value = '';
      document.getElementById("description").value = '';
      document.getElementById("id").valu='null';
      currentStep = steps.Points;
    }
    const closeDialog = () => {
      let currentid = document.getElementById("id").value;
      let title = document.getElementById("title").value;
      let description = document.getElementById("description").value;
      if(currentid === 'null'){
        console.log("Add New Point");
        let id=points.length;
        let newPoint = {
          title,
          description,
          id,
          latitude:pointLatLng.lat,
          longitude:pointLatLng.lng,
          pointRef:newPointRef,
          images:imageList
        }
        console.log(newPoint);
        points.push(newPoint);
      }else{
        console.log(points);
        console.log(currentid);
        let index = points.findIndex(point =>point.id ==currentid);
        console.log(index);
        points[index].title = title;
        points[index].description = description;
        points[index].images = imageList;
      }
      document
        .getElementById("dialogBackground")
        .classList.remove("dialogBackgroundVisible");
      document.getElementById("dialog").classList.remove("visible");
      document.getElementById("title").value = '';
      document.getElementById("description").value = '';
      document.getElementById("id").value = 'null';
      newPointRef = null;
      imageList = [];
      dialogImage.src = '';
      currentStep =steps.Points;
    };
    const pointClicked =(lat,lng)=>{
      let point = points.find(point=>point.latitude ===lat && point.longitude ===lng);
      setDialogContent(point);
      document.getElementById("dialog").classList.toggle("visible");
    }
    const setDialogImages = (imageList) =>{

    }
    const setDialogContent = (point) => {
      currentImage = 0;
      imageList = [];
      content = point
      let previousImgBtn = document.getElementById("previous");
      let nextImgBtn = document.getElementById("next");
      imageList = content.images;
      if (imageList.length <= 1) {
        if (!previousImgBtn.classList.contains("hide")) {
          previousImgBtn.classList.add("hide");
        }
        if (!nextImgBtn.classList.contains("hide")) {
          nextImgBtn.classList.add("hide");
        }
      } else {
        nextImgBtn.classList.remove("hide");
        previousImgBtn.classList.remove("hide");
      }
      document.getElementById("id").value = point.id;
      document.getElementById("title").value = point.title;
      document.getElementById("description").value = point.description;
      if(imageList.length>0){
        dialogImage.src = imageList[currentImage]?.image;
      }
    };
        const handleBackgroundClick = () => {
      closeDialog();
    };
    const handlePreviousImage = () => {
      currentImage =
        currentImage > 0 ? currentImage - 1 : imageList.length - 1;
      dialogImage.opacity = 0;
      dialogImage.src = imageList[currentImage].image;
      dialogImage.opacity = 1;
    };
    const handleNextImage = () => {
      currentImage = (currentImage + 1) % imageList.length;
      dialogImage.opacity = 0;
      dialogImage.src = imageList[currentImage].image;
      dialogImage.opacity = 1;
    };
    const buildImagePreview = (imgPath)=>{
      let parent = document.getElementById("imageList");
      let imageContainer = document.createElement('div');
      imageContainer.id = document.getElementsByClassName('previewImageContainer').length; //want to be able to delete it easily
      imageContainer.className = "previewImageContainer"
      imageContainer.setAttribute("image",imgPath);
      let image = document.createElement('img');
      image.src =imgPath;
      let deleteBtn = document.createElement('button');
      deleteBtn.className="imageDeleteBtn";
      let deleteBtnIcon = document.createElement('img')
      deleteBtnIcon.src = "./assets/delete.png";
      deleteBtn.appendChild(deleteBtnIcon);
      deleteBtn.onclick = ()=>{console.log(`Delete image: ${imageContainer.id}`); document.getElementById(imageContainer.id).remove()};
      imageContainer.appendChild(image);
      imageContainer.appendChild(deleteBtn);
      parent.appendChild(imageContainer);

    }
    const handleAddImage = ()=>{
      console.log(imageList);
      if(imageList.length>0){
        console.log("NEED to add images to dialog");
        imageList.map((image)=>{
          buildImagePreview(image.image);
        })
      }
      document.getElementById("imageAdd").showModal(); 
    }
    const cancelImageSelect = () =>{
      document.getElementById("imageAdd").close(); 
    }
    const handleImagesSelected = ()=>{
     
      let images = document.getElementsByClassName("previewImageContainer");
      for(let image of images){
        let imageObj = {image:image.getAttribute("image")}
        imageList.push(imageObj);
      }
      document.getElementById("imageLink").value='';
      document.getElementById("imageList").innerHTML = '';
      dialogImage.src = imageList[currentImage].image;
      document.getElementById("imageAdd").close(); 
    }
    
    

    const setCurrentLatLang = () => {
      addCenterMarker();
      map.setView(currentMapCenter);
    };
    const advanceToPoints = () => {
      currentStep = steps.Points;
      advanceProgress("mapCenterProgress","pointsProgress")
      setInstructions("Add points", "Click to create points");
    };
    
    


    const addNewPoint = (latlng) => {
      document.getElementById("id").value = 'null';
      currentStep = steps.Editing;
      pointLatLng = latlng;
      console.log(pointLatLng);
      let point = L.marker(latlng).addTo(map);
      point.on("click",(e)=>{
        console.log(e);
        pointClicked(e.latlng.lat,e.latlng.lng);
      });
      newPointRef = point;
      document.getElementById("dialog").classList.toggle("visible");
    };

    
    //State Management
        const advanceProgress = (previousId,nextId) =>{
      document.getElementById(previousId).classList.remove("active");
      document.getElementById(previousId).classList.add("completed");
      if(nextId && nextId.length>0){
      document.getElementById(nextId).classList.add("active");
      }
    }
        const setInstructions = (title, subtitle) => {
      document.getElementById("instructions").innerText = title;
      document.getElementById("subtitle").innerText = subtitle;
    };
    const finishStep = () => {
      console.log(currentStep);
      switch (currentStep) {
        case steps.Intro:
          advanceToBaseLayers();
          break;
        case steps.BaseLayer:
          setBaseLayers();
          document.getElementById("baseLayerSelection").close();
          advanceToMapCenter();
          break;
        case steps.Center:
          advanceToPoints();
          break;
        case steps.Points:
          currentStep = steps.Bounds;
          advanceProgress("pointsProgress","boundsProgress");
          document.getElementById("boundsSelectionDialog").showModal();
          break;
        case steps.Bounds:
          currentStep = steps.MinZoomLevel;
          document.getElementById("zoomSelection").showModal();
          break;
        case steps.MinZoomLevel:
          minZoomLevel = map.getZoom();
          currentStep = steps.MaxZoomLevel;
          advanceProgress("boundsProgress","zoomProgress");
          advanceToSelectMaxZoom();
          break;
        case steps.MaxZoomLevel:
          maxZoomLevel = map.getZoom();
          handleComplete();
          break;
      }
    };
    const handleComplete = ()=>{
      advanceProgress("zoomProgress","")
      let cleanedPoints = points.map(point =>{
        console.log(point);
        return {
          id:point.id,
          title:point.title,
          description:point.description,
          latitude:point.latitude,
          longitude:point.longitude,
          images:point.images
        }
      })
      let mapObject = {
        mapCenter:currentMapCenter,
        baseLayers:baseLayers,
        minZoom:minZoomLevel,
        maxZoom:maxZoomLevel,
        mapBounds:boundsRect.getBounds(),
        pointsOfInterest:cleanedPoints
      }
      console.log(mapObject);
      let jsonString = JSON.stringify(mapObject);
      var data = new Blob([jsonString], {type: 'application/json'});

      let textFile = window.URL.createObjectURL(data);
      document.getElementById("downloadLink").href=textFile;
      console.log(jsonString);
      document.getElementById("completedMap").showModal();
    }
    const initializeMap = (
      startCoordinates = [0, 0],
      zoomLevel = 3,
      maxZoomLevel = 15,
      minZoomLevel = 3,
      zoomPosition = "bottomright"
    ) => {
      map = L.map("map").setView(startCoordinates, zoomLevel);

      map.zoomControl.remove();
      if (minZoomLevel !== maxZoomLevel) {
        L.control
          .zoom({
            position: zoomPosition,
          })
          .addTo(map);
      }
      setBaseLayers();
      map.on("click", (e) => {
        console.log(currentStep)
        if (currentStep == steps.Center) {
          currentMapCenter = e.latlng;
          setCurrentLatLang();
          return;
        }
        if (currentStep == steps.Points) {
          addNewPoint(e.latlng);
        }
        if(currentStep == steps.Bounds && !isClicked){
          originalZoomlevel = map.getZoom();
          startPos = e.latlng
      }
      if(currentStep == steps.Bounds && isClicked){
            bounds = L.latLngBounds(startPos,e.latlng);
            console.log(bounds);
            map.setMaxBounds(bounds);
            map.fitBounds(bounds);
            setInstructions("Your current map bounds","")
      }  
        
        isClicked = !isClicked;
      });
      map.on("mousemove", (e) => {
        if (currentStep !== steps.Bounds) {
          return;
        }
        if (isClicked) {
          console.log(`Moved: ${e.latlng}`);
          bounds = L.latLngBounds(startPos, e.latlng);
          endPos = e.latlng;
          let previousRects = document.getElementsByClassName("zoomRect");
          if (previousRects) {
            for (let element of previousRects) {
              console.log(element);
              setInstructions("Click to select other corner of your bounds", "");
              element.remove();
            }
          }
          boundsRect = L.rectangle(bounds, {
            color: "#FFFF00",
            weight: 1,
            className: "zoomRect",
          }).addTo(map);
          
          
        }
      });
    };
    const initializePointsOfInterest = (points) => {
      points.map((point) => {
        var marker = L.marker([point.latitude, point.longitude]).addTo(map);
        marker.on("click", () => {
          poiClicked(point.id);
        });
      });
    };


    
    const load = async () => {
      let data = await fetch("./data.json");
      let json = await data.json();
      pointsOfInterest = json.pointsOfInterest;
      initializePointsOfInterest(pointsOfInterest);
    };
    initializeMap();

    //document.getElementById("intro").showModal()
  </script>
</html>
